---
import Layout from "../layouts/Layout.astro";
import PostCard from "../components/blog/PostCard.astro";
import HeroGlass from "../components/home/HeroGlass.astro";
import { getSortedPosts } from "../lib/content";
import IconViewBox from "../components/icons/IconViewBox.astro";
import IconArrowRight from "../components/icons/IconArrowRight.astro";
import { SITE_CONFIG } from "../config";

const posts = await getSortedPosts();

// Fortress-Level: Safe Array Access
const latestPost = posts.length > 0 ? posts[0] : null;
const otherPosts = posts.length > 1 ? posts.slice(1, 4) : [];
---

<Layout title="首页" nebulaVariant="default">
    <div
        class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 auto-rows-[minmax(200px,auto)] relative z-10 max-w-7xl mx-auto px-4 py-8"
    >
        <!-- Hero Section: Crystal Flagship (Span 2x2) -->
        <HeroGlass />

        <!-- Latest Post (Span 2x2 if big enough, or 2x1) -->
        {
            latestPost && (
                <div class="md:col-span-2 md:row-span-2 h-full">
                    <PostCard post={latestPost} loading="eager" />
                </div>
            )
        }

        <!-- Other Posts -->
        {
            otherPosts.map((post) => (
                <div class="md:col-span-1 md:row-span-1 h-64">
                    <PostCard post={post} />
                </div>
            ))
        }

        <!-- 'View All' Link Block (Holographic Button) -->
        <a
            href="/archive"
            class="md:col-span-1 md:row-span-1 relative group overflow-hidden rounded-3xl bg-surface/30 border border-white/5 hover:border-accent/50 transition-all flex flex-col items-center justify-center p-6"
        >
            <div
                class="absolute inset-0 bg-gradient-to-br from-accent/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"
            >
            </div>

            <div
                class="relative z-10 w-12 h-12 mb-4 rounded-xl bg-white/5 flex items-center justify-center group-hover:scale-110 transition-transform duration-300 border border-white/10 group-hover:border-accent/30"
            >
                <IconViewBox
                    class="w-6 h-6 text-text-secondary group-hover:text-accent transition-colors"
                />
            </div>

            <span
                class="text-text-secondary group-hover:text-white font-medium flex items-center gap-2 relative z-10"
            >
                {SITE_CONFIG.ui.viewArchive}
                <IconArrowRight
                    class="w-4 h-4 transition-transform group-hover:translate-x-1 text-accent"
                />
            </span>
        </a>
    </div>
</Layout>
