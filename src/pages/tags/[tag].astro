---
import Layout from '../../layouts/Layout.astro';
import PostCard from '../../components/blog/PostCard.astro';
import { getUniqueTags, getPostsByTag } from '../../lib/content';
import { SITE_CONFIG } from '../../config';
import IconArrowRight from '../../components/icons/IconArrowRight.astro';

export async function getStaticPaths() {
    const uniqueTags = await getUniqueTags();

    return Promise.all(
        uniqueTags.map(async (tag) => {
            const posts = await getPostsByTag(tag);
            return {
                params: { tag },
                props: { posts },
            };
        })
    );
}

const tag = decodeURIComponent(Astro.params.tag ?? '');
const { posts } = Astro.props;
---

<Layout title={`话题: ${tag}`}>
    <div class="max-w-7xl mx-auto px-4 py-12">
        <div class="mb-12 flex flex-col md:flex-row items-center justify-between gap-6">
            <div class="text-center md:text-left">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-accent/10 border border-accent/20 text-accent text-sm font-mono mb-4"
                >
                    <span>TOPIC</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">
                    <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-white to-white/60"
                        >#</span
                    >
                    {tag}
                </h1>
                <p class="text-text-secondary">
                    {SITE_CONFIG.ui.tags.found(posts.length)}
                </p>
            </div>

            <a
                href="/tags"
                class="px-6 py-3 rounded-xl border border-white/10 hover:bg-white/5 hover:border-accent/50 transition-all flex items-center gap-2 group"
            >
                <span class="text-sm text-text-secondary group-hover:text-white"
                    >{SITE_CONFIG.ui.tags.allTopics}</span
                >
                <IconArrowRight
                    class="w-4 h-4 stroke-current text-text-secondary group-hover:text-accent group-hover:translate-x-1 transition-all"
                />
            </a>
        </div>

        <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-[minmax(300px,auto)]"
        >
            {
                posts.map((post) => (
                    <div class="h-full">
                        <PostCard post={post} />
                    </div>
                ))
            }
        </div>
    </div>
</Layout>
