---
import Layout from '../../layouts/Layout.astro';
import PostCard from '../../components/blog/PostCard.astro';
import { getUniqueTags, getPostsByTag } from '../../lib/content';
import { SITE_CONFIG } from '../../config';
import IconArrowRight from '../../components/icons/IconArrowRight.astro';

export async function getStaticPaths() {
    const uniqueTags = await getUniqueTags();

    return Promise.all(
        uniqueTags.map(async (tag) => {
            const posts = await getPostsByTag(tag);
            return {
                params: { tag },
                props: { posts },
            };
        })
    );
}

const tag = decodeURIComponent(Astro.params.tag ?? '');
const { posts } = Astro.props;
---

<Layout title={`话题: ${tag}`}>
    <div class="mx-auto max-w-7xl px-4 py-12">
        <div class="mb-12 flex flex-col items-center justify-between gap-6 md:flex-row">
            <div class="text-center md:text-left">
                <div
                    class="bg-accent/10 border-accent/20 text-accent mb-4 inline-flex items-center gap-2 rounded-full border px-3 py-1 font-mono text-sm"
                >
                    <span>TOPIC</span>
                </div>
                <h1 class="mb-2 text-4xl font-bold text-white md:text-5xl">
                    <span
                        class="bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent"
                        >#</span
                    >
                    {tag}
                </h1>
                <p class="text-text-secondary">
                    {SITE_CONFIG.ui.tags.found(posts.length)}
                </p>
            </div>

            <a
                href="/tags"
                class="hover:border-accent/50 group flex items-center gap-2 rounded-xl border border-white/10 px-6 py-3 transition-all hover:bg-white/5"
            >
                <span class="text-text-secondary text-sm group-hover:text-white"
                    >{SITE_CONFIG.ui.tags.allTopics}</span
                >
                <IconArrowRight
                    class="text-text-secondary group-hover:text-accent h-4 w-4 stroke-current transition-all group-hover:translate-x-1"
                />
            </a>
        </div>

        <div
            class="grid auto-rows-[minmax(300px,auto)] grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"
        >
            {
                posts.map((post) => (
                    <div class="h-full">
                        <PostCard post={post} />
                    </div>
                ))
            }
        </div>
    </div>
</Layout>
