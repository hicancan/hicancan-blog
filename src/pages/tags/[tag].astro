---
import Layout from "../../layouts/Layout.astro";
import PostCard from "../../components/PostCard.astro";
import { getUniqueTags, getPostsByTag } from "../../utils/content";

export async function getStaticPaths() {
    const uniqueTags = await getUniqueTags();

    return Promise.all(
        uniqueTags.map(async (tag) => {
            const posts = await getPostsByTag(tag);
            return {
                params: { tag },
                props: { posts },
            };
        }),
    );
}

const tag = decodeURIComponent(Astro.params.tag ?? "");
const { posts } = Astro.props;
// sortedPosts is now just posts, as they are sorted in getPostsByTag
const sortedPosts = posts;
---

<Layout title={`话题: ${tag}`}>
    <div class="max-w-7xl mx-auto px-4 py-12">
        <div
            class="mb-12 flex flex-col md:flex-row items-center justify-between gap-6"
        >
            <div class="text-center md:text-left">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-accent/10 border border-accent/20 text-accent text-sm font-mono mb-4"
                >
                    <span>TOPIC</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">
                    <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-white to-white/60"
                        >#</span
                    >
                    {tag}
                </h1>
                <p class="text-text-secondary">
                    Found {posts.length} article{posts.length > 1 ? "s" : ""}
                </p>
            </div>

            <a
                href="/tags"
                class="px-6 py-3 rounded-xl border border-white/10 hover:bg-white/5 hover:border-accent/50 transition-all flex items-center gap-2 group"
            >
                <span class="text-sm text-text-secondary group-hover:text-white"
                    >All Topics</span
                >
                <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    class="stroke-current text-text-secondary group-hover:text-accent group-hover:translate-x-1 transition-all"
                    ><path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg
                >
            </a>
        </div>

        <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-[minmax(300px,auto)]"
        >
            {
                sortedPosts.map((post) => (
                    <div class="h-full">
                        <PostCard post={post} />
                    </div>
                ))
            }
        </div>
    </div>
</Layout>
